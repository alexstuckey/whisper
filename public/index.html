<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Whisper</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
	<div class="container">
		<div class="row">
			<h1 class="muted">Whisper</h1>
			<hr>
		</div>
		<div class="row">
			<div class="span9">
				<table class="table table-bordered" id="msgLog">
					<thead>
						<th>User</th>
						<th>Message</th>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
			<div class="span3">
				<table class="table table-bordered" id="sidebar">
					<thead>
						<th>Name</th>
					</thead>
					<tbody>
						<td class="form-inline">
							<div class="input-append">
								<input type="text" id="nameEntry" class="" style="width: 110px;" placeholder="James">
								<button class="btn" type="button">Change</button>
							</div>
						</td>
					</tbody>
					<thead>
						<th>Users online</th>
					</thead>
					<tbody>
						<td id="connectedUsersCell">0</td>
					</tbody>
				</table>
			</div>
		</div>
		<div class="row">
			<div class="span9">
				<textarea id="textEntry" class="span6"></textarea>
				<button class="btn btn-large pull-right" onclick="SendMessage();">Send message</button>
			<div>
		</div>
	</div>
	<script src="/js/jquery.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
	  var socket = io.connect(window.location.origin);

	  socket.on('down', function (data) {
	  	var msg = JSON.parse(data);
	    console.log(msg.user + ' said \"' + msg.message + '\"');
	    $('#msgLog > tbody:last').append('<tr><td>' + msg.user + '</td><td>' + msg.message + '</td></tr>');
	  });

	  socket.on('users', function (data) {
	    console.log('Connected users: ' + data);
	    $('#connectedUsersCell').text(data + " users");
	  });

	  function SendMessage(){
	  	var msgToSend = {
	  		user: $('#nameEntry').val(),
	  		message: $('#textEntry').val()
	  	};
	  	socket.emit('up', JSON.stringify(msgToSend));
	  	console.log('Sent message!');
	  };
	</script>
</body>
</html>